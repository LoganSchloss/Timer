<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timer BLE</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #f0f2f5; }
        .container { text-align: center; background: white; padding: 2.5rem; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 85%; }
        #display { font-size: 3.5rem; font-weight: bold; margin-bottom: 2rem; color: #333; }
        #btBtn { background-color: #007bff; color: white; border: none; padding: 18px; border-radius: 12px; font-weight: bold; width: 100%; cursor: pointer; }
        small { font-size: 2rem; color: #888; }
    </style>
</head>
<body>
    <div class="container">
        <div id="display">00:00:00.<small>00</small></div>
        <button id="btBtn">ðŸ”µ CONNETTI BLUETOOTH</button>
        <p id="status">Stato: Disconnesso</p>
    </div>
    <script>
        let startTime, elapsedTime = 0, timerInterval;
        const display = document.getElementById('display');
        const btBtn = document.getElementById('btBtn');

        function toggleTimer() {
            if (!timerInterval) {
                startTime = Date.now() - elapsedTime;
                timerInterval = setInterval(() => {
                    elapsedTime = Date.now() - startTime;
                    let ss = Math.floor((elapsedTime % 60000) / 1000).toString().padStart(2, "0");
                    let ms = Math.floor((elapsedTime % 1000) / 10).toString().padStart(2, "0");
                    display.innerHTML = `00:00:${ss}.<small>${ms}</small>`;
                }, 10);
            } else {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        btBtn.onclick = async () => {
            const device = await navigator.bluetooth.requestDevice({
                filters: [{ name: 'TimerESP32' }],
                optionalServices: ['4fafc201-1fb5-459e-8fcc-c5c9c331914b']
            });
            const server = await device.gatt.connect();
            const service = await server.getPrimaryService('4fafc201-1fb5-459e-8fcc-c5c9c331914b');
            const char = await service.getCharacteristic('beb5483e-36e1-4688-b7f5-ea07361b26a8');
            await char.startNotifications();
            document.getElementById('status').innerText = "CONNESSO âœ…";
            char.addEventListener('characteristicvaluechanged', toggleTimer);
        };
    </script>
</body>
</html>
